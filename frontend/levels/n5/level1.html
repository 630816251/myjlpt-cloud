<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>N5-1 åŸºç¤åè©ï½œMyJLPT Cloud</title>

<style>
:root{
  --bg:#f5f6f8;
  --card:#ffffff;
  --border:#d9dee6;
  --brand:#3a6f8f;
  --ok:#16a34a;
  --err:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Helvetica, Arial, "Noto Sans TC", sans-serif;
  background:var(--bg);
}
header{
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.brand{font-weight:900;color:var(--brand);}
.btn{
  border:1px solid var(--border);
  background:#fff;
  padding:8px 14px;
  border-radius:10px;
  font-weight:800;
  cursor:pointer;
}
.wrap{
  max-width:900px;
  margin:24px auto;
  padding:0 16px;
}
.game{
  background:#fff;
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
}
.board{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
.card{
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  margin-bottom:8px;
  text-align:center;
  font-weight:900;
  cursor:pointer;
}
.card.selected{border-color:var(--brand);background:#e6f0f6;}
.card.ok{background:#dcfce7;border-color:var(--ok);}
.card.err{background:#fee2e2;border-color:var(--err);}
.footer{margin-top:16px;font-weight:900;color:#6b7280;}
.done{text-align:center;padding:30px;}
</style>
</head>

<body>

<header>
  <div class="brand">MyJLPT Cloudï½œN5-1</div>
  <button class="btn" onclick="location.href='../n5.html'">è¿”å› N5 é—œå¡</button>
</header>

<div class="wrap">
  <h2>N5-1 åŸºç¤åè©</h2>
  <div class="game" id="game"></div>
</div>

<script>
/* ========= APIï¼ˆéŒ¯é¡Œå¯«å…¥ DynamoDBï¼‰ ========= */
const API = "https://3y29jupv6j.execute-api.us-east-1.amazonaws.com/wrong";

function recordWrong(jp, zh){
  fetch(API,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      userId:"demo-user",
      tier:"N5",
      stage:"1",
      jp, zh
    })
  }).catch(err=>console.error("âŒ wrong record failed", err));
}

/* ========= é¡Œåº« ========= */
const WORDS = [
  { id:1, jp:"äºº", zh:"äºº" },
  { id:2, jp:"å­¦ç”Ÿ", zh:"å­¸ç”Ÿ" },
  { id:3, jp:"å­¦æ ¡", zh:"å­¸æ ¡" },
  { id:4, jp:"å…ˆç”Ÿ", zh:"è€å¸«" },
  { id:5, jp:"å‹é”", zh:"æœ‹å‹" }
];

/* ğŸ”¥ é—œéµï¼šåªå­˜ã€Œå®Œæˆæ•¸é‡ã€ */
const STORAGE_KEY = "vocab_progress_n5_1";

/* ========= ç‹€æ…‹ ========= */
let left=[], right=[];
let first=null;
let solvedCount=0;
let locked=false;

/* ========= å·¥å…· ========= */
const shuffle = a => [...a].sort(()=>Math.random()-0.5);
const save = () => localStorage.setItem(STORAGE_KEY, solvedCount);
const load = () => solvedCount = parseInt(localStorage.getItem(STORAGE_KEY) || "0", 10);

/* ========= ç•«é¢ ========= */
function render(){
  const game=document.getElementById("game");

  if(solvedCount === WORDS.length){
    game.innerHTML=`
      <div class="done">
        <h2>ğŸ‰ é—œå¡å®Œæˆï¼</h2>
        <p>ä½ å·²å®Œæˆ N5-1 åŸºç¤åè©ã€‚</p>
        <button class="btn" onclick="location.href='../n5.html'">å›åˆ° N5 é—œå¡</button>
      </div>`;
    return;
  }

  game.innerHTML=`
    <div class="board">
      <div id="left"></div>
      <div id="right"></div>
    </div>
    <div class="footer">å®Œæˆï¼š${solvedCount} / ${WORDS.length}</div>
  `;

  const L=document.getElementById("left");
  const R=document.getElementById("right");

  left.forEach(w=>{
    const d=document.createElement("div");
    d.className="card";
    d.textContent=w.jp;
    d.onclick=()=>pick(d,w,"jp");
    L.appendChild(d);
  });

  right.forEach(w=>{
    const d=document.createElement("div");
    d.className="card";
    d.textContent=w.zh;
    d.onclick=()=>pick(d,w,"zh");
    R.appendChild(d);
  });
}

/* ========= é…å°é‚è¼¯ ========= */
function pick(el, w, side){
  if(locked || el.classList.contains("ok")) return;

  el.classList.add("selected");

  if(!first){
    first = { el, w, side };
    return;
  }

  locked = true;

  // ===== é…å°æ­£ç¢º =====
  if(first.w.id === w.id && first.side !== side){

    // å¾è³‡æ–™é™£åˆ—ç§»é™¤ï¼ˆğŸ”¥é—œéµï¼‰
    left  = left.filter(x => x.id !== w.id);
    right = right.filter(x => x.id !== w.id);

    solvedCount++;
    save();

    setTimeout(() => {
      first = null;
      locked = false;
      render();   // é‡æ–° render â†’ å·²æ¶ˆé™¤
    }, 300);

  } 
  // ===== é…å°éŒ¯èª¤ =====
  else {
    el.classList.add("err");
    first.el.classList.add("err");

    recordWrong(first.w);   // å­˜éŒ¯é¡Œï¼ˆæ”¹æˆæ•´é¡Œï¼‰

    setTimeout(() => {
      el.className = "card";
      first.el.className = "card";
      first = null;
      locked = false;
    }, 500);
  }
}

/* ========= åˆå§‹åŒ– ========= */
function init(){
  load();
  left=shuffle(WORDS);
  right=shuffle(WORDS);
  render();
}
init();
</script>

</body>
</html>
